addphoto -- набор программ для создания фотоальбомов, таких, как
например, http://slazav.mccme.ru/pam08.htm

======================================================================
    Системные требования

* bash, perl
* exiv2
* ImageMagick (convert, intentify)
* xfig + transfig -- рекомендуется для картинок с пометками,
  желательна сборка из altlinux и 8-битная кодировка...

======================================================================
    С чего начать

* скопировать фотографии для фотоальбома в некоторую директорию DIR
* уменьшить фотографии:
  # ph_towww DIR/*
* создать заготовку для альбома:
  # addphoto_ini DIR
* должны появиться файлы DIR.txt и DIR.htm, в последнем можно
  посмотреть браузером, что поучилось
* редактировать DIR.txt, добавлять комментарии к фотографиям, fig-файлы
  с пометками...
* обновить альбом
  # addphoto DIR.txt DIR.htm
* если некоторые строчки \photo были удалены, можно почистить и
  директорию от соответствующих файлов:
  # addphoto_clean DIR

======================================================================
    Исходные предположения и формат входного файла

* фотографии для альбома живут в некоторой директории, например album
* Исходный файл для оглавления живет рядом с этой директорией в файле
  album.txt (впрочем, расширение может быть любым).
* Созданное оглавление попадает в файл album.htm (на этот файл стоят
  ссылки со страниц фотографий)

album.txt -- файл произвольного вида, в котором встречаются строки:

\photo <название файла с картинкой> <комментарий к картинке>
-- Вставить картинку. Если такие строчки идут подряд, картинки
располагаются горизонтально. Если между такими строчками появляется
пустая строка или другой текст -- начинается новый ряд фотографий.

\photor <название файла с картинкой> <комментарий к картинке>
или
\photol <название файла с картинкой> <комментарий к картинке>
-- Такие фотографиии встают справа или слева от текста.

\end
-- Дальнейший текст не обрабатывается и в альбом не попадает.

Весь остальной текст (предполагается, что это html) копируется
в фотоальбом без изменений.

======================================================================
    Программы

* addphoto album.txt album.htm
Обновить оглавление фотоальбома, html-страницы для фотографий,
при необходимости -- превьюки, картинки с пометками...

* addphoto_cleanup <dir>
Удалить (или показать) файлы, не относящиеся к данному фотоальбому
См. addphoto_cleanup -h
(Немного смущает удаление исходных больших фотографий. Возможно,
поведение по умолчанию будет изменено, например, еиспользуемые
фотографии будут переложены в специальную директорию).

* addphoto_ini <dir>
Создать заготовку для фотоальбома.

* addphoto_mkfig <image>
Создать fig-заготовку для рисования пометок на фотографии.
Удобно использовать совместно с gqview, для этого добавить в .gqviewrc
что-то вроде такого:
external_8: "fig" "file=%p; addphoto_mkfig $file; xfig ${file%.*}.fig &"

======================================================================
    Более мелкие программки, некоторые из которых бывают
    полезны вне addphoto:

* ph_resize <in_image> <out_image> [m1 [m2 [m3]]]
Умное перемасштабирование картинки в соответствии с параметрами
m1, m2, m3. Вычисление окончательного размера изображения происходит
следующим образом:
- Размер изображения уменьшается, пока не влезет в квадрат m1 x m1
- Если это необходимо (изображение слишком узкое), размер увеличивается,
  чтобы меньшая сторона достигла величины m2
- Если это необходимо (изображение слишком длинное), размер уменьшается,
  чтобы большая сторона достигла величины m3
- Если после этих операций размер изображения уменьшился - оно
  перемасштабируется.
В данный момент мои любимые значения:
m1=800 m2=400 m3=5000 для больших картинок (они же значения по умолчанию),
m1=200 m2=100 m3=600  для превьюшек.
Таким образом, изображения впишутся к квадрат 800х800, однако длинные
панорамы увеличатся, чтоб не быть уже 400 точек, но и не длиннее 5000
точек...

* ph_towww <images>
Преобразовать картинки для публикации в интернете: перемасштабировать с
помощью ph_resize (с параметрами по умолчанию), удалить thumbnails

* ph_addgeo <time shift> <plt track-file> <jpg files>
Добавить gps-координаты в exif-данные фотографий в соответствии с треком.
<time shift>     -- смещение времени в треке
<plt track-file> -- трек в формате plt (OziExplorer)
<jpg files>      -- картинки с правильным временем в exif-данных

* ph_size <image>
Простое получение размеров картинки. Выдает два числа через пробел.

* ph_canon_rename <jpg files>
Вернуть фотографиям, снятым фотоаппаратом Canon, исходные названия.

* ph_update_www <image>
Программа, используемая в addphoto. Изготавливает все необходимое
окружение для картинки в фотоальбоме, например: image.jpg + image.fig ->
image.htm, _image.jpg (превью), image.gif (пометки). См. ph_update_www -h

* ph_exif <jpg file>
Печать некоторых exif-данных фотографии в формате key="value".
Используется в ph_update_www. Судьба этой программы пока непонятна:
может быть, она будет переименована в ph_data или даже pd_data и будет
собирать информацию о фотографии из разных мест (специфичных для моей
системы хранения фотографий).

    Замечания шлите на <slazav@altlinux.org>
