addphoto -- набор программ для создания фотоальбомов, таких, как
например, http://slazav.mccme.ru/giss07.htm

======================================================================
    Системные требования

* bash, perl
* exiv2
* ImageMagick (convert, identify)
* xfig + transfig -- рекомендуется для картинок с пометками.

======================================================================
    С чего начать

* Скопировать фотографии для фотоальбома в некоторую директорию,
например, album. Уменьшить фотографии, если надо. Это можно сделать
любым удобным способом, в частности так:
  $ ph_towww album/*.jpg

* Создать заготовку для альбома:
  $ addphoto_ini album
При этом должны появиться файлы album.txt и album.htm, последний
можно открыть браузером и посмотреть, что поучилось.

* Редактировать album.txt, добавлять комментарии к фотографиям
fig-файлы с пометками...

* Обновить альбом:
  $ addphoto album.txt > album.htm

* если некоторые строчки \photo были удалены, можно почистить и
директорию от соответствующих файлов:
  $ addphoto_cleanup album

======================================================================
    Структура фотоальбома

* Пусть исходный файл для оглавления фотоальбома живет в файле album.txt
  (расширение может быть любым, но нужно, чтобы оно было).
* Фотографии для альбома живут рядом в директории album
* Созданное оглавление попадает в файл album.htm (на этот файл стоят
  ссылки со страниц фотографий)

Фотографии можно положить в поддиректории внутри album, в этом случае
в исходном файле следует указывать пути относительно album:
\photo day1/foto5.jpg
Использование в этом месте абсолютных путей и путей с '..' запрещено.

======================================================================
    Формат исходного файла

На вход программы дается файл произвольного вида (предполагается,
что это html), в котором могут встречаться специальные команды,
начинающиеся с новой стороки:

    \photo <название файла с картинкой> <комментарий к картинке>
Вставить картинку. Если такие строчки идут подряд, картинки
располагаются горизонтально. Если между такими строчками появляется
пустая строка или другой текст -- начинается новый ряд фотографий.

Для каждой картинки создается уменьшенная копия, которая вставляется
в текст. и отдельный html-файл с различной информацией.

    \photor <название файла с картинкой> <комментарий к картинке>
    \photol <название файла с картинкой> <комментарий к картинке>
То же, но фотографиии встают справа или слева от текста.

    \h[1234] <текст>
Заголовок 1..4 уровня, например <h1>текст</h1>. Для таких
заголовков возможно создание оглавления командой \toc.

    \h[1234]r <текст>
То же, но перед заголовком вставляется горизонтальная линейка.

    \toc
Создать оглавление со ссылками на все заголовки, находящиеся в файле.

    \end
Дальнейший текст не обрабатывается и в альбом не попадает.

    \#
Комментарий. Эта строка игнорируется.

    \\<любая строка>
Вставить символ '\' в начало строки.

    \keep <файлы>
Хранить файлы, не относящиеся напрямую к альбому. В списке файлов
можно использовать *, ?, {,} и т.п.
Команда используется только при чистке альбома от устаревших файлов.
В обычном режиме эта строка игнорируется.

Весь остальной текст копируется в фотоальбом без изменений.

======================================================================
    Известные проблемы

Белые пометки на фотографиях исчезают, поскольку белый цвет используется
в качестве фона и становится прозрачным.

======================================================================
    Программы

* addphoto album.txt > album.htm
Обновить оглавление фотоальбома, html-страницы для фотографий,
при необходимости -- превьюшки, картинки с пометками...

* addphoto_cleanup album.txt
Удалить (или показать) файлы, не относящиеся к данному фотоальбому
См. addphoto_cleanup -h
(Немного смущает удаление исходных больших фотографий. Возможно,
поведение по умолчанию будет изменено, например, неиспользуемые
фотографии будут переложены в специальную директорию).

* addphoto_ini <dir>
Создать заготовку для фотоальбома.

* addphoto_mkfig <image>
Создать fig-заготовку для рисования пометок на фотографии.
Удобно использовать совместно с gqview, для этого добавить в .gqviewrc
что-то вроде такого:
external_8: "fig" "file=%p; addphoto_mkfig $file; xfig ${file%.*}.fig &"

======================================================================
    Более мелкие программки, некоторые из которых бывают
    полезны вне addphoto:

* ph_resize <in_image> <out_image> [m1 [m2 [m3]]]
Умное перемасштабирование картинки в соответствии с параметрами
m1, m2, m3. Вычисление окончательного размера изображения происходит
следующим образом:
- Размер изображения уменьшается, пока не влезет в квадрат m1 x m1
- Если это необходимо (изображение слишком узкое), размер увеличивается,
  чтобы меньшая сторона достигла величины m2
- Если это необходимо (изображение слишком длинное), размер уменьшается,
  чтобы большая сторона достигла величины m3
- Если после этих операций размер изображения уменьшился - оно
  перемасштабируется.
В данный момент мои любимые значения:
m1=800 m2=400 m3=5000 для больших картинок (они же значения по умолчанию),
m1=200 m2=100 m3=600  для превьюшек.
Таким образом, изображения впишутся к квадрат 800х800, однако длинные
панорамы увеличатся, чтоб не быть уже 400 точек, но и не длиннее 5000
точек...

* ph_towww <images>
Преобразовать картинки для публикации в интернете: перемасштабировать с
помощью ph_resize (с параметрами по умолчанию), удалить thumbnails

* ph_size <image>
Простое получение размеров картинки. Выдает два числа через пробел.

* ph_canon_rename <jpg files>
Вернуть фотографиям, снятым фотоаппаратом Canon, исходные названия.

* ph_update_www <image>
Программа, используемая в addphoto. Изготавливает все необходимое
окружение для картинки в фотоальбоме, например:
image.jpg + image.fig ->
  image.htm, _image.jpg (превью), image.gif (пометки).
См. ph_update_www -h

* ph_exif <jpg file>
Печать некоторых exif-данных фотографии в формате key="value".
Используется в ph_update_www. Судьба этой программы пока непонятна:
может быть, она будет переименована в ph_data или даже pd_data и будет
собирать информацию о фотографии из разных мест (специфичных для моей
системы хранения фотографий).

    Замечания шлите на <slazav@altlinux.org>
